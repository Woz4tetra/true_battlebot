import numpy as np
from app.field_label.nhrl_cam_label_app import cost_function
from bw_shared.geometry.transform3d import Transform3D
from geometry_msgs.msg import Quaternion, Vector3


def main() -> None:
    point_cloud_in_camera_1 = np.array(
        [
            [-1.1204686, -0.07332093, 1.6194229],
            [-0.7866976, -0.48541, 2.2209275],
            [0.2738699, -0.5140096, 2.3735878],
            [0.3745811, -0.3948753, 2.2334657],
            [-0.38383663, -0.4786653, 2.2529233],
            [-0.5056171, -0.32730064, 2.0432339],
            [0.97677565, -0.46478462, 2.2829807],
            [1.2095778, 0.2433005, 1.4749849],
            [1.2067641, 0.301658, 1.3920765],
            [-1.1055406, -0.02428154, 1.5634834],
            [-1.3558364, 0.0562156, 1.3772752],
            [-0.90456194, -0.52927977, 2.262226],
            [-0.6649817, -0.57808954, 2.3550227],
            [-0.02376216, -0.5363427, 2.3723378],
            [1.0773584, -1.5114487, 4.504822],
            [0.69307894, -0.46827143, 2.3623648],
            [1.1915271, -0.21274038, 2.0596225],
            [-0.08628999, -0.56484014, 2.4011302],
            [-0.6448035, -0.23173004, 1.8988254],
            [-0.48555452, -0.44910443, 2.2016277],
            [-0.6980185, -0.39500824, 2.112355],
            [-0.94514793, -0.36946458, 2.0435495],
            [-1.0258089, -0.3900309, 2.061992],
        ]
    )
    pixels_in_nhrl_cam = np.array(
        [
            [1260, 799],
            [783, 687],
            [717, 333],
            [945, 331],
            [886, 520],
            [1096, 518],
            [579, 120],
            [1225, 200],
            [1259, 214],
            [1324, 662],
            [1275, 817],
            [515, 804],
            [412, 712],
            [704, 422],
            [542, 246],
            [623, 198],
            [922, 155],
            [603, 444],
            [1180, 550],
            [932, 547],
            [996, 602],
            [1001, 687],
            [938, 754],
        ]
    )
    tf_camera1_from_map = Transform3D.from_position_and_quaternion(
        Vector3(x=0.03941022025471275, y=-0.19565944966846532, z=1.9114094509158834),
        Quaternion(x=0.8906964626133567, y=0.0209090387488028, z=0.024619310676768615, w=0.45344959606126617),
    ).inverse()

    nhrl_cx = 796.5824560505099
    nhrl_cy = 611.9271068019821
    nhrl_fx = 455.86940156857224
    nhrl_fy = 455.86940156857224

    map_nhrl_x = 0.0
    map_nhrl_y = 0.0
    map_nhrl_z = 0.0
    map_nhrl_qx = 0.0
    map_nhrl_qy = 0.0
    map_nhrl_qz = 0.0
    map_nhrl_qw = 1.0

    cost_function(
        point_cloud_in_camera_1,
        pixels_in_nhrl_cam,
        tf_camera1_from_map.tfmat,
        nhrl_cx,
        nhrl_cy,
        nhrl_fx,
        nhrl_fy,
        map_nhrl_x,
        map_nhrl_y,
        map_nhrl_z,
        map_nhrl_qx,
        map_nhrl_qy,
        map_nhrl_qz,
        map_nhrl_qw,
    )


if __name__ == "__main__":
    main()
