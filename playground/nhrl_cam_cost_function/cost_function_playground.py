import numpy as np
from app.field_label.nhrl_cam_label_app import cost_function
from bw_shared.geometry.rpy import RPY
from bw_shared.geometry.transform3d import Transform3D
from geometry_msgs.msg import Vector3


def main() -> None:
    camera_0_plane_points = np.array(
        [
            [-1.1204685148003963, -0.07332092603227937, 1.6194227656311644],
            [-0.7866975887590901, -0.4854099818054555, 2.220927371426528],
            [0.27386989738616907, -0.5140095864539678, 2.3735878076741113],
            [0.37170291741299893, -0.39184117173316585, 2.2163043176821713],
            [-0.3842624209362142, -0.4791962806092585, 2.255422441199125],
            [-0.5027492973521076, -0.32544423750062457, 2.031644953326123],
            [1.0390272122827449, -0.49440613326343624, 2.428478905390671],
            [1.1799239664356753, 0.23733577811870252, 1.4388243705657895],
            [1.1789196707763037, 0.29469765863466546, 1.3599562311419757],
            [-1.0989690595133759, -0.02413720983483799, 1.554189672706308],
            [-1.3890008602784714, 0.05759066220196775, 1.4109641025218282],
            [-0.9080728182582345, -0.5313340650500133, 2.271006495814828],
            [-0.6674959364928178, -0.5802752202814094, 2.363926718322689],
            [-0.023763506781505926, -0.5363730584647934, 2.372472185418521],
            [0.7627666308868494, -1.0701013713636194, 3.1894008913759615],
            [0.69023233112104, -0.4663481564779341, 2.3526620977282304],
            [1.1903790928722915, -0.21253540142465213, 2.0576380816638147],
            [-0.0864875954567199, -0.566133601915414, 2.4066287027433884],
            [-0.6404870832505166, -0.23017879770056648, 1.8861142987747874],
            [-0.4860431619869935, -0.4495563918249241, 2.203843375138899],
            [-0.695441135310336, -0.3935497120137696, 2.104555356996148],
            [-0.9458625960811147, -0.36974394332521104, 2.045094747959298],
            [-1.027320101251167, -0.39060546487269526, 2.0650295542805956],
        ]
    )
    nhrl_camera_pixels = np.array(
        [
            [1260, 799],
            [783, 687],
            [717, 333],
            [945, 331],
            [886, 520],
            [1096, 518],
            [579, 120],
            [1225, 200],
            [1259, 214],
            [1324, 662],
            [1275, 817],
            [515, 804],
            [412, 712],
            [704, 422],
            [542, 246],
            [623, 198],
            [922, 155],
            [603, 444],
            [1180, 550],
            [932, 547],
            [996, 602],
            [1001, 687],
            [938, 754],
        ]
    )
    tf_camera0_from_map = Transform3D.from_position_and_rpy(
        Vector3(-0.07525483623559652, -1.661565405146573, 0.9627351602589949), RPY((-2.200, -0.063, 0.015))
    )

    nhrl_cx = 796.5824560505099
    nhrl_cy = 611.9271068019821
    nhrl_fx = 455.86940156857224
    nhrl_fy = 455.86940156857224

    tf_map_from_nhrl = Transform3D.from_position_and_rpy(Vector3(1.2, 0.0, 1.0), RPY((0.0, -45.0, 90.0)))

    cost = cost_function(
        camera_0_plane_points,
        nhrl_camera_pixels,
        tf_camera0_from_map.tfmat,
        nhrl_cx,
        nhrl_cy,
        nhrl_fx,
        nhrl_fy,
        tf_map_from_nhrl.x,
        tf_map_from_nhrl.y,
        tf_map_from_nhrl.z,
        tf_map_from_nhrl.quaternion.x,
        tf_map_from_nhrl.quaternion.y,
        tf_map_from_nhrl.quaternion.z,
        tf_map_from_nhrl.quaternion.w,
    )
    print(cost)


if __name__ == "__main__":
    main()
